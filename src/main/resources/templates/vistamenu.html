<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>BookHaven - Inicio</title>
    <link rel="icon" href="MainLogo.png" type="image/png">
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Font Awesome icons (free version)-->
    <script
      src="https://use.fontawesome.com/releases/v6.3.0/js/all.js"
      crossorigin="anonymous"
    ></script>
    <!-- Google fonts-->
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat:400,700"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic"
      rel="stylesheet"
      type="text/css"
    />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="inicioStyle.css" rel="stylesheet" />
  </head>
  <body id="page-top">
    <!-- Navigation-->
    <nav
      class="navbar navbar-expand-lg bg-secondary text-uppercase fixed-top"
      id="mainNav"
    >
      <div class="container">
        <a href="#page-top"><img src="MainLogo2.png" style="width: 55px; height: auto; margin-right: 7px;"></a>
        <a class="navbar-brand" href="#page-top">BookHaven</a>
        <button
          class="navbar-toggler text-uppercase font-weight-bold bg-primary text-white rounded"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarResponsive"
          aria-controls="navbarResponsive"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          Menu
          <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item mx-0 mx-lg-1">
              <a class="nav-link py-3 px-0 px-lg-3 rounded" href="#portfolio"
                >Portafolio</a
              >
            </li>
            <li class="nav-item mx-0 mx-lg-1">
              <a class="nav-link py-3 px-0 px-lg-3 rounded" href="#about"
                >Acerca</a
              >
            </li>
            <li class="nav-item mx-0 mx-lg-1">
              <a class="nav-link py-3 px-0 px-lg-3 rounded" href="#contact"
                >Contactanos</a
              >
            </li>
            <li id="botonCerrarSesion" class="nav-item mx-0 mx-lg-1">
                <a style="color: red;" class="nav-link py-3 px-0 px-lg-3 rounded " 
                  >Cerrar Sesion</a
                >
              </li>
              
              <li id="botonNavAdministrar" class="nav-item mx-0 mx-lg-1">
                
              </li>

              <li class="nav-item mx-0 mx-lg-1">
                <a href="perfil"><div class="circuloMiPerfil" id="circuloMiPerfil"></div></a>
              </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- Masthead-->
    <header class="masthead bg-primary text-white text-center">
      <div class="container d-flex align-items-center flex-column">
        <!-- Masthead Avatar Image-->
        <img
          class="masthead-avatar mb-5"
          src="MainLogo.png"
          alt="..."
        />
        <!-- Masthead Heading-->
        <h1 class="masthead-heading text-uppercase mb-0">Libreria Virtual BookHaven</h1>
        <!-- Icon Divider-->
        <div class="divider-custom divider-light">
          <div class="divider-custom-line"></div>
          <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
          <div class="divider-custom-line"></div>
        </div>
        <!-- Masthead Subheading-->
        <p class="masthead-subheading font-weight-light mb-0">
          Literatura - Cuentos - Cientifico 
        </p>
      </div>
    </header>
    <!-- Portfolio Section-->
    <section class="page-section portfolio" id="portfolio">
      <div class="container">
        <!-- Portfolio Section Heading-->
        <h2
          class="page-section-heading text-center text-uppercase text-secondary mb-0"
        >
          Portafolio
        </h2>
        <!-- Icon Divider-->
        <div class="divider-custom">
          <div class="divider-custom-line"></div>
          <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
          <div class="divider-custom-line"></div>
        </div>
        <!-- Portfolio Grid Items-->
        <div class="row justify-content-center">
          <!-- Portfolio Item 1-->
          <div id="portfolioContainer" class="row"></div>
          
        </div>
      </div>
      <!-- Modal para Confirmar la Compra -->
      <div class="modal fade" id="comprarModal" tabindex="-1" aria-labelledby="comprarModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="comprarModalLabel">Confirmar Compra</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
              ¿Estás seguro de que quieres comprar este libro?
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</button>
              <button type="button" class="btn btn-success" id="btnComprar">Confirmar Compra</button>
            </div>
          </div>
        </div>
      </div>

    </section>
    <!-- About Section-->
    <section class="page-section bg-primary text-white mb-0" id="about">
      <div class="container">
        <!-- About Section Heading-->
        <h2 class="page-section-heading text-center text-uppercase text-white">
          Acerca de nosotros
        </h2>
        <!-- Icon Divider-->
        <div class="divider-custom divider-light">
          <div class="divider-custom-line"></div>
          <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
          <div class="divider-custom-line"></div>
        </div>
        <!-- About Section Content-->
        <div class="row">
          <div class="col-lg-4 ms-auto">
            <p class="lead">
              BookHaven es una librería moderna creada para los amantes de los libros. Nos especializamos en ofrecer una amplia variedad de títulos. En BookHaven, creemos que cada libro tiene el poder de transformar una vida, y nos esforzamos por hacer que cada lectura sea una experiencia única.
            </p>
          </div>
          <div class="col-lg-4 me-auto">
            <p class="lead">
              Contamos con un equipo apasionado por la literatura y el conocimiento, dispuesto a ayudarte a encontrar el libro perfecto para cada ocasión. Además, nuestra plataforma en línea te permite explorar nuestro catálogo de manera fácil y cómoda, para que puedas disfrutar de la lectura desde la comodidad de tu hogar.
            </p>
          </div>
        </div>
        <!-- About Section Button-->
        <div class="text-center mt-4">
          <a
            class="btn btn-xl btn-outline-light"
            href="https://startbootstrap.com/theme/freelancer/"
          >
            <i class="fas fa-download me-2"></i>
            Mas Informacion
          </a>
        </div>
      </div>
    </section>
    <!-- Contact Section-->
    <section class="page-section" id="contact">
      <div class="container">
        <!-- Contact Section Heading-->
        <h2
          class="page-section-heading text-center text-uppercase text-secondary mb-0"
        >
          Contactanos
        </h2>
        <!-- Icon Divider-->
        <div class="divider-custom">
          <div class="divider-custom-line"></div>
          <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
          <div class="divider-custom-line"></div>
        </div>
        <!-- Contact Section Form-->
        <div class="row justify-content-center">
          <div class="col-lg-8 col-xl-7">

            <form id="contactForm" data-sb-form-api-token="API_TOKEN">
              <!-- Name input-->
              <div class="form-floating mb-3">
                <input
                  class="form-control"
                  id="name"
                  type="text"
                  placeholder="Enter your name..."
                  data-sb-validations="required"
                />
                <label for="name">Nombre Completo</label>
                <div class="invalid-feedback" data-sb-feedback="name:required">
                  Es requerido un nombre.
                </div>
              </div>
              <!-- Email address input-->
              <div class="form-floating mb-3">
                <input
                  class="form-control"
                  id="email"
                  type="email"
                  placeholder="name@example.com"
                  data-sb-validations="required,email"
                />
                <label for="email">Correo Electronico</label>
                <div class="invalid-feedback" data-sb-feedback="email:required">
                  Es requerido un email.
                </div>
                <div class="invalid-feedback" data-sb-feedback="email:email">
                  El email no es valido.
                </div>
              </div>
              <!-- Phone number input-->
              <div class="form-floating mb-3">
                <input
                  class="form-control"
                  id="phone"
                  type="tel"
                  placeholder="(123) 456-7890"
                  data-sb-validations="required"
                />
                <label for="phone">Numero de celular</label>
                <div class="invalid-feedback" data-sb-feedback="phone:required">
                  Un numero de celular es requerido.
                </div>
              </div>
              <!-- Message input-->
              <div class="form-floating mb-3">
                <textarea
                  class="form-control"
                  id="message"
                  type="text"
                  placeholder="Enter your message here..."
                  style="height: 10rem"
                  data-sb-validations="required"
                ></textarea>
                <label for="message">Mensaje</label>
                <div
                  class="invalid-feedback"
                  data-sb-feedback="message:required"
                >
                  Un mensaje es requerido.
                </div>
              </div>

              <div class="d-none" id="submitSuccessMessage">
                <div class="text-center mb-3">
                  <div class="fw-bolder">Form submission successful!</div>
                  To activate this form, sign up at
                  <br />
                  <a href="https://startbootstrap.com/solution/contact-forms"
                    >https://startbootstrap.com/solution/contact-forms</a
                  >
                </div>
              </div>

              <div class="d-none" id="submitErrorMessage">
                <div class="text-center text-danger mb-3">
                  Error sending message!
                </div>
              </div>
              <!-- Submit Button-->
              <button
                class="btn btn-primary btn-xl disabled"
                id="submitButton"
                type="submit"
              >
                Enviar
              </button>
            </form>
          </div>
        </div>
      </div>
    </section>
    <!-- Footer-->
    <footer class="footer text-center">
      <div class="container">
        <div class="row">
          <!-- Footer Location-->
          <div class="col-lg-4 mb-5 mb-lg-0">
            <h4 class="text-uppercase mb-4">Locacion</h4>
            <p class="lead mb-0">
              Cl. 54a #30-01, Medellín
              <br />
              Villa Hermosa, Medellín, Antioquia
            </p>
          </div>
          <!-- Footer Social Icons-->
          <div class="col-lg-4 mb-5 mb-lg-0">
            <h4 class="text-uppercase mb-4">Nuestras redes</h4>
            <a class="btn btn-outline-light btn-social mx-1" href="#!"
              ><i class="fab fa-fw fa-facebook-f"></i
            ></a>
            <a class="btn btn-outline-light btn-social mx-1" href="#!"
              ><i class="fab fa-fw fa-twitter"></i
            ></a>
            <a class="btn btn-outline-light btn-social mx-1" href="#!"
              ><i class="fab fa-fw fa-linkedin-in"></i
            ></a>
            <a class="btn btn-outline-light btn-social mx-1" href="#!"
              ><i class="fab fa-fw fa-dribbble"></i
            ></a>
          </div>
          <!-- Footer About Text-->
          <div class="col-lg-4">
            <h4 class="text-uppercase mb-4">Correos de contacto</h4>
            <p class="lead mb-0">
              BookHavenMedellin@gmail.com
              BookHavenContacto@gmail.com
            </p>
          </div>
        </div>
      </div>
    </footer>
    <!-- Copyright Section-->
    <div class="copyright py-4 text-center text-white">
      <div class="container">
        <small>Copyright &copy; BookHaven 2024</small>
      </div>
    </div>
    <!-- Portfolio Modals-->
    <!-- Portfolio Modal 1-->
    <div id="modalContainer"></div>

    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Core theme JS-->
    <script src="js/scripts.js"></script>
    <script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  </body>
</html>

<script>
    const token = localStorage.getItem("token");
    let dataUsuario = [];

    if (token) {
        // Verificar el token al cargar la página
        fetch("/verify-token", {
            method: "GET",
            headers: {
            Authorization: `Bearer ${token}`,
            },
        })
            .then((response) => {
            if (response.ok) {
                return response.json(); // Aquí obtenemos los datos de la respuesta
            } else {
                // Token inválido, redirigir al inicio
                window.location.href = "/";
            }
            })
            .then((data) => {
              dataUsuario = data;
              
              traerLibros();

              const botonCirculoMiPerfil = document.getElementById('circuloMiPerfil');
              const capitalizedSub = data.sub.charAt(0).toUpperCase()
              botonCirculoMiPerfil.innerHTML = `<label style="color: black;text-align: center;font-size: 30px; cursor: pointer">${capitalizedSub}</label>`;

              if (data.IdRol == 1) {
              // Seccion de administrador
              const botonNavAdministrar = document.getElementById('botonNavAdministrar');
              botonNavAdministrar.innerHTML = `<a style="color: green;" class="nav-link py-3 px-0 px-lg-3 rounded" href="/administrar">Administrar</a>`;
              }
            
            })
            .catch((error) => {
            console.error("Error al verificar el token:", error);
            window.location.href = "/";
            });
        } else {
        // Si no hay token, redirigir al inicio
    window.location.href = "/";
    }


  window.addEventListener("DOMContentLoaded", (event) => {
    
    // Navbar shrink function
    var navbarShrink = function () {
      const navbarCollapsible = document.body.querySelector("#mainNav");
      if (!navbarCollapsible) {
        return;
      }
      if (window.scrollY === 0) {
        navbarCollapsible.classList.remove("navbar-shrink");
      } else {
        navbarCollapsible.classList.add("navbar-shrink");
      }
    };

    // Shrink the navbar
    navbarShrink();

    // Shrink the navbar when page is scrolled
    document.addEventListener("scroll", navbarShrink);

    // Activate Bootstrap scrollspy on the main nav element
    const mainNav = document.body.querySelector("#mainNav");
    if (mainNav) {
      new bootstrap.ScrollSpy(document.body, {
        target: "#mainNav",
        rootMargin: "0px 0px -40%",
      });
    }

    // Collapse responsive navbar when toggler is visible
    const navbarToggler = document.body.querySelector(".navbar-toggler");
    const responsiveNavItems = [].slice.call(
      document.querySelectorAll("#navbarResponsive .nav-link")
    );
    responsiveNavItems.map(function (responsiveNavItem) {
      responsiveNavItem.addEventListener("click", () => {
        if (window.getComputedStyle(navbarToggler).display !== "none") {
          navbarToggler.click();
        }
      });
    });
  });

  document.getElementById('botonCerrarSesion').addEventListener('click', function() {
  // Eliminar el token del localStorage
  localStorage.removeItem('token'); // Reemplaza 'token' con la clave exacta que estás usando para almacenar el token
  location.reload();
  });

  function traerLibros() {
    // Hacer un fetch para obtener los libros según el rol
    fetch("http://localhost:8080/libros", {
        method: "GET",
        headers: {
            id_rol: dataUsuario.IdRol, // Aquí envías el valor del id_rol
        },
    })
    .then((response) => {
        if (!response.ok) {
            throw new Error("Error en la solicitud");
        }
        return response.json(); // Convertimos la respuesta a JSON
    })
    .then((libros) => {
        const portfolioContainer = document.getElementById("portfolioContainer"); // Contenedor donde se agregarán las tarjetas
        const modalContainer = document.getElementById("modalContainer"); // Contenedor donde se agregarán los modales

        libros.forEach((libro, index) => {
            // Crear el contenido de la tarjeta de portafolio para cada libro
            const cardHTML = `
                <div class="col-md-6 col-lg-4 mb-5">
                    <div class="portfolio-item mx-auto text-center" data-bs-toggle="modal" data-bs-target="#portfolioModal${index + 1}">
                        <div class="portfolio-item-caption d-flex align-items-center justify-content-center h-100 w-100" id="portfolioLibro${index + 1}">
                            <div class="portfolio-item-caption-content text-center text-white">
                                <i class="fas fa-plus fa-3x"></i>
                            </div>
                        </div>
                        <img style="height: 280px;" class="img-fluid" src="${libro.imagenLibroLink}" alt="${libro.titulo}" />
                    </div>
                </div>
            `;

            // Crear el modal para cada libro
            const modalHTML = `
              <div class="portfolio-modal modal fade" id="portfolioModal${index + 1}" tabindex="-1" aria-labelledby="portfolioModal${index + 1}" aria-hidden="true">
                  <div class="modal-dialog modal-xl" >
                      <div class="modal-content">
                          <div class="modal-header border-0 pb-0" style="height: 70px;">
                              <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <div class="modal-body text-center pb-5 pt-0">
                              <div class="container">
                                  <div class="row justify-content-center">
                                      <div class="col-lg-8">
                                          <h2 class="portfolio-modal-title text-secondary text-uppercase mb-0">${libro.titulo}</h2>
                                          <div class="divider-custom">
                                              <div class="divider-custom-line"></div>
                                              <div class="divider-custom-icon">
                                                  <i class="fas fa-star"></i>
                                              </div>
                                              <div class="divider-custom-line"></div>
                                          </div>
                                          <img class="img-fluid rounded mb-5" style="height: 280px;margin-bottom: 30px !important;" src="${libro.imagenLibroLink}" alt="${libro.titulo}" />
                                          <div style="background-color: #e7e7e7;height: 40px; border: 1px solid gray;">Detalles Del Producto</div>
                                          <table style="width:100%; border-collapse: collapse; border-left: 1px solid gray; border-right: 1px solid gray; border-bottom: 1px solid gray;">
                                              <tr>
                                                  <td style="padding: 8px; font-weight: bold; border-right: 1px solid gray; border-bottom: 1px solid gray;background-color: #e7e7e74f;">Título:</td>
                                                  <td style="padding: 8px; border-bottom: 1px solid gray;">${libro.titulo}</td>
                                              </tr>
                                              <tr>
                                                  <td style="padding: 8px; font-weight: bold; border-right: 1px solid gray; border-bottom: 1px solid gray;background-color: #e7e7e74f;">Autor:</td>
                                                  <td style="padding: 8px; border-bottom: 1px solid gray;">${libro.autor}</td>
                                              </tr>
                                              <tr>
                                                  <td style="padding: 8px; font-weight: bold; border-right: 1px solid gray; border-bottom: 1px solid gray;background-color: #e7e7e74f;">Páginas:</td>
                                                  <td style="padding: 8px; border-bottom: 1px solid gray;">${libro.numeroPaginas}</td>
                                              </tr>
                                              <tr>
                                                  <td style="padding: 8px; font-weight: bold; border-right: 1px solid gray; border-bottom: 1px solid gray;background-color: #e7e7e74f;">Año:</td>
                                                  <td style="padding: 8px; border-bottom: 1px solid gray;">${libro.anioPublicacion}</td>
                                              </tr>
                                              <tr>
                                                  <td style="padding: 8px; font-weight: bold; border-bottom: 1px solid gray;border-right: 1px solid gray;background-color: #e7e7e74f;">Género:</td>
                                                  <td style="padding: 8px;border-bottom: 1px solid gray;">${libro.genero}</td>
                                              </tr>
                                              <tr>
                                                  <td style="padding: 8px; font-weight: bold; border-right: 1px solid gray;background-color: #6eff00;">Precio:</td>
                                                  <td style="padding: 8px;background-color: #6eff00;">${libro.precio} COP</td>
                                              </tr>
                                          </table>
                                          <button class="btn btn-danger mt-3" data-bs-dismiss="modal">
                                              <i class="fas fa-xmark fa-fw"></i>
                                              Cerrar ventana
                                          </button>
                                          <button class="btn btn-success mt-3" data-bs-toggle="modal" data-bs-target="#comprarModal" data-id="${libro.id}" data-titulo="${libro.titulo}">
                                              <i class="fas fa-check fa-fw"></i>
                                              Comprar
                                          </button>
                                      </div>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          `;


            // Insertar el HTML en el contenedor
            portfolioContainer.innerHTML += cardHTML;
            modalContainer.innerHTML += modalHTML;
        });
    })
    .catch((error) => {
        console.error("Error en la solicitud:", error);
    });
}


let idLibroComprarMenu = null;

document.getElementById('btnComprar').addEventListener('click', function() {
  return fetch('http://localhost:8080/compras/comprar', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        tituloLibro: idLibroComprarMenu,
        username: dataUsuario.sub
        }),
    })
    .then(response => response.json())
    .then(result => {
      $("#comprarModal").modal("hide");
      alert("Compra realizada con exito, todos los detalles fueron enviados a el correo electronico registrado con tu cuenta")
    })
    .catch(error => {
      console.error('Error:', error);
      throw error;
    });
})

document.addEventListener('click', function(event) {
    // Verificar si el clic fue en un botón de compra
    if (event.target.matches('button[data-bs-target="#comprarModal"]')) {
        // Obtener el titulo
        idLibroComprarMenu = event.target.getAttribute('data-titulo');
    }
});





</script>
