<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>BookHaven - Inicio</title>
    <link rel="icon" href="MainLogo.png" type="image/png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Toastr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastr@2.1.4/build/toastr.min.css">

    <!-- Font Awesome icons (free version)-->
    <script
      src="https://use.fontawesome.com/releases/v6.3.0/js/all.js"
      crossorigin="anonymous"
    ></script>
    <!-- Google fonts-->
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat:400,700"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic"
      rel="stylesheet"
      type="text/css"
    />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="inicioStyle.css" rel="stylesheet" />
  </head>
  <body id="page-top">
    <!-- Navigation-->
    <nav
      class="navbar navbar-expand-lg bg-secondary text-uppercase fixed-top"
      id="mainNav"
    >
      <div class="container">
        <a href="#page-top"><img src="MainLogo2.png" style="width: 55px; height: auto; margin-right: 7px;"></a>
        <a class="navbar-brand" href="vistamenu">BookHaven</a>
        <button
          class="navbar-toggler text-uppercase font-weight-bold bg-primary text-white rounded"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarResponsive"
          aria-controls="navbarResponsive"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          Menu
          <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item mx-0 mx-lg-1">
              <a class="nav-link py-3 px-0 px-lg-3 rounded" href="#portfolio"
                >Mi Perfil</a
              >
            </li>
            <li class="nav-item mx-0 mx-lg-1">
              <a class="nav-link py-3 px-0 px-lg-3 rounded" href="#about"
                >Acerca</a
              >
            </li>
            <li id="botonCerrarSesion" class="nav-item mx-0 mx-lg-1">
                <a style="color: red;" class="nav-link py-3 px-0 px-lg-3 rounded " 
                  >Cerrar Sesion</a
                >
              </li>
              
              <li id="botonNavAdministrar" class="nav-item mx-0 mx-lg-1">
                
              </li>

              <li class="nav-item mx-0 mx-lg-1">
                <a href="perfil"><div class="circuloMiPerfil" id="circuloMiPerfil"></div></a>
              </li>
          </ul>
        </div>
      </div>
    </nav>
   
    <section class="page-section portfolio" id="portfolio">
        <div class="container" style="margin-top: 100px;">
            <div class="container mb-5">
            <h2 class="page-section-heading text-center text-uppercase ">
                Mi Perfil
              </h2>
            </div>
            <div class="row justify-content-center">
                <div id="userInfo">
                </div>
            </div>
        </div>
        

        <div class="modal fade" id="nuevaContrasenaModal" tabindex="-1" aria-labelledby="nuevaContrasenaModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="nuevaContrasenaModalLabel">Cambiar Contraseña</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
              </div>
              <div class="modal-body">
                <div class="form-group mb-2">
                  <label class="mb-2">Contraseña Actual</label>
                  <input type="password" id="generoEditarLibro" class="form-control" required />
                </div>
                <div class="form-group mb-2">
                  <label class="mb-2">Contraseña Nueva</label>
                  <input type="password" id="contraseñaNueva" class="form-control" required minlength="8" />
              </div>
              <div class="form-group mb-3">
                  <label class="mb-2">Confirmar Contraseña Nueva</label>
                  <input type="password" id="confirmarContraseñaNueva" class="form-control" required minlength="8" />
              </div>              
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-success" id="btnCambiarContrasena">Confirmar</button>
              </div>
            </div>
          </div>
        </div>
    </section>
    <!-- About Section-->
    <section class="page-section bg-primary text-white mb-0" id="about">
      <div class="container">
        <!-- About Section Heading-->
        <h2 class="page-section-heading text-center text-uppercase text-white">
          Acerca de nosotros
        </h2>
        <!-- Icon Divider-->
        <div class="divider-custom divider-light">
          <div class="divider-custom-line"></div>
          <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
          <div class="divider-custom-line"></div>
        </div>
        <!-- About Section Content-->
        <div class="row">
            <div class="col-lg-4 ms-auto">
              <p class="lead">
                BookHaven es una librería moderna creada para los amantes de los libros. Nos especializamos en ofrecer una amplia variedad de títulos. En BookHaven, creemos que cada libro tiene el poder de transformar una vida, y nos esforzamos por hacer que cada lectura sea una experiencia única.
              </p>
            </div>
            <div class="col-lg-4 me-auto">
              <p class="lead">
                Contamos con un equipo apasionado por la literatura y el conocimiento, dispuesto a ayudarte a encontrar el libro perfecto para cada ocasión. Además, nuestra plataforma en línea te permite explorar nuestro catálogo de manera fácil y cómoda, para que puedas disfrutar de la lectura desde la comodidad de tu hogar.
              </p>
            </div>
          </div>
          <!-- About Section Button-->
          <div class="text-center mt-4">
            <a
              class="btn btn-xl btn-outline-light"
              href="https://startbootstrap.com/theme/freelancer/"
            >
              <i class="fas fa-download me-2"></i>
              Mas Informacion
            </a>
        </div>
      </div>
    </section>
    <!-- Contact Section-->
    
    <!-- Footer-->
    <footer class="footer text-center">
      <div class="container">
        <div class="row">
          <!-- Footer Location-->
          <div class="col-lg-4 mb-5 mb-lg-0">
            <h4 class="text-uppercase mb-4">Location</h4>
            <p class="lead mb-0">
                Cl. 54a #30-01, Medellín
                <br />
                Villa Hermosa, Medellín, Antioquia
              </p>
          </div>
          <!-- Footer Social Icons-->
          <div class="col-lg-4 mb-5 mb-lg-0">
            <h4 class="text-uppercase mb-4">Nuestras redes</h4>
            <a class="btn btn-outline-light btn-social mx-1" href="#!"
              ><i class="fab fa-fw fa-facebook-f"></i
            ></a>
            <a class="btn btn-outline-light btn-social mx-1" href="#!"
              ><i class="fab fa-fw fa-twitter"></i
            ></a>
            <a class="btn btn-outline-light btn-social mx-1" href="#!"
              ><i class="fab fa-fw fa-linkedin-in"></i
            ></a>
            <a class="btn btn-outline-light btn-social mx-1" href="#!"
              ><i class="fab fa-fw fa-dribbble"></i
            ></a>
          </div>
          <!-- Footer About Text-->
          <div class="col-lg-4">
            <h4 class="text-uppercase mb-4">Correos de contacto</h4>
            <p class="lead mb-0">
              BookHavenMedellin@gmail.com
              BookHavenContacto@gmail.com
            </p>
          </div>
        </div>
      </div>
    </footer>
    <!-- Copyright Section-->
    <div class="copyright py-4 text-center text-white">
      <div class="container">
        <small>Copyright &copy; BookHaven 2024</small>
      </div>
    </div>
   
    
    <!-- Portfolio Modal 5-->
    <div
      class="portfolio-modal modal fade"
      id="portfolioModal5"
      tabindex="-1"
      aria-labelledby="portfolioModal5"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header border-0">
            <button
              class="btn-close"
              type="button"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body text-center pb-5">
            <div class="container">
              <div class="row justify-content-center">
                <div class="col-lg-8">
                  <!-- Portfolio Modal - Title-->
                  <h2
                    class="portfolio-modal-title text-secondary text-uppercase mb-0"
                  >
                    Locked Safe
                  </h2>
                  <!-- Icon Divider-->
                  <div class="divider-custom">
                    <div class="divider-custom-line"></div>
                    <div class="divider-custom-icon">
                      <i class="fas fa-star"></i>
                    </div>
                    <div class="divider-custom-line"></div>
                  </div>
                  <!-- Portfolio Modal - Image-->
                  <img
                    class="img-fluid rounded mb-5"
                    src="assets/img/portfolio/safe.png"
                    alt="..."
                  />
                  <!-- Portfolio Modal - Text-->
                  <p class="mb-4">
                    Lorem ipsum dolor sit amet, consectetur adipisicing elit.
                    Mollitia neque assumenda ipsam nihil, molestias magnam,
                    recusandae quos quis inventore quisquam velit asperiores,
                    vitae? Reprehenderit soluta, eos quod consequuntur itaque.
                    Nam.
                  </p>
                  <button class="btn btn-primary" data-bs-dismiss="modal">
                    <i class="fas fa-xmark fa-fw"></i>
                    Close Window
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    
      
    </div>


    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Core theme JS-->
    <script src="js/scripts.js"></script>
    <script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>

  </body>
</html>


<Script>
let dataUsuario = null;

document.addEventListener("DOMContentLoaded", () => {
  const token = localStorage.getItem('token');

  if (token) {
      // Verificar el token al cargar la página
      fetch('/verify-token', {
          method: 'GET',
          headers: {
              'Authorization': `Bearer ${token}`
          }
      })
      .then(response => {
          if (response.ok) {
              // Invocamos response.json() para obtener los datos del cuerpo
              return response.json(); // Aquí obtenemos los datos de la respuesta
          } else {
              // Token inválido, redirigir al inicio
              window.location.href = '/';
          }
      })
      .then(data => {
        dataUsuario = data;    
        const botonCirculoMiPerfil = document.getElementById('circuloMiPerfil');
            const capitalizedSub = data.sub.charAt(0).toUpperCase()
            botonCirculoMiPerfil.innerHTML = `<label style="color: black;font-size: 30px; cursor: pointer;">${capitalizedSub}</label>`;
          if (data.IdRol == 1) {
          // Seccion de administrador
          const botonNavAdministrar = document.getElementById('botonNavAdministrar');
          botonNavAdministrar.innerHTML = `<a style="color: green;" class="nav-link py-3 px-0 px-lg-3 rounded" href="/administrar">Administrar</a>`;
          }

          // Mostrar los datos en el HTML
          const userInfoDiv = document.getElementById('userInfo');
                  userInfoDiv.innerHTML = `
                  <div style="margin: auto;  display: flex; justify-content: center; align-items: center;">
                      <div class="infoPerfilStyleContainer">
                          <div class="infoPerfilStyle mb-5" style="display: flex;justify-content: center;" data-bs-toggle="modal" data-bs-target="#nuevaContrasenaModal">
                              <div class="titulo tituloCambiarContraseña" style="width: 200px;background: orange; cursor: pointer"> 
                                <i class="bi bi-key-fill" style="font-size:20px;margin-right: 5px;"></i> 
                                <label style="cursor: pointer" data-bs-toggle="modal" data-bs-target="#nuevaContrasenaModal">Cambiar Contraseña</label>
                              </div>
                          </div>
                          <div class="infoPerfilStyle">
                              <div class="titulo">Nombre de usuario:</div>
                              <div class="contenido">${data.sub}</div>
                          </div>
                          <div class="infoPerfilStyle">
                              <div class="titulo">Correo electronico:</div>
                              <div class="contenido">${data.correo}</div>
                          </div>
                          <div class="infoPerfilStyle">
                              <div class="titulo">Nombre:</div>
                              <div class="contenido">${data.nombre}</div>
                          </div>
                          <div class="infoPerfilStyle">
                              <div class="titulo">Apellido:</div>
                              <div class="contenido">${data.apellido}</div>
                          </div>
                          <div class="infoPerfilStyle">
                              <div class="titulo">Rol:</div>
                              <div class="contenido">${data.rol}</div>
                          </div>
                      </div>
                  </div>

                      `;
          
      })
      .catch(error => {
          console.error('Error al verificar el token:', error);
          window.location.href = '/';
      });
  } else {
      // Si no hay token, redirigir al inicio
      window.location.href = '/';
  }

});

document.getElementById('botonCerrarSesion').addEventListener('click', function() {
  // Eliminar el token del localStorage
  localStorage.removeItem('token'); // Reemplaza 'token' con la clave exacta que estás usando para almacenar el token
  location.reload();
});

document.getElementById('botonCerrarSesion').addEventListener('click', function() {
  // Eliminar el token del localStorage
  localStorage.removeItem('token'); // Reemplaza 'token' con la clave exacta que estás usando para almacenar el token
  location.reload();
});

document.getElementById('btnCambiarContrasena').addEventListener('click', function() {
  let inputContrasenaActual = document.getElementById('generoEditarLibro').value;
  let inputNuevaContrasena = document.getElementById('contraseñaNueva').value;
  let inputConfirmarContrasena = document.getElementById('confirmarContraseñaNueva').value;

  fetch(`http://localhost:8080/usuarios/${dataUsuario.id}/actualizar-contrasena`, {
    method: "PUT",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({
      contrasenaActual: inputContrasenaActual,
      nuevaContrasena: inputNuevaContrasena,
      confirmarContrasena: inputConfirmarContrasena
    }),
  })
    .then((response) => {
      let errorCambiarContraseñaBackend = null;
      // Leer el cuerpo de la respuesta
      response.text().then((body) => {
        errorCambiarContraseñaBackend = body
        if (response.ok) {
          $("#nuevaContrasenaModal").modal("hide");
          toastr.options.positionClass = 'toast-bottom-right';
          toastr.options.toastClass = 'toast-success';
          toastr.success('Contraseña Cambiada Exitosamente');
        } else {
          toastr.options.positionClass = 'toast-bottom-right';
          toastr.options.toastClass = 'toast-error';
          toastr.error(errorCambiarContraseñaBackend);
        }
      });
    })
    .catch((error) => {
      toastr.options.positionClass = 'toast-bottom-right';
      toastr.options.toastClass = 'toast-error';
      toastr.error(errorCambiarContraseñaBackend);
    });
});









</Script>